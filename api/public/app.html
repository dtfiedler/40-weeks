<!DOCTYPE html>
<html>
<head>
	<title>Your Pregnancy Journey - 40Weeks</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Track your pregnancy journey with 40Weeks">
	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = {
			theme: {
				extend: {
					fontFamily: {
						'sans': ['Poppins', 'system-ui', 'sans-serif'],
						'serif': ['DM Serif Display', 'serif'],
					},
					colors: {
						primary: {
							50: '#fffbeb',
							100: '#fef3c7',
							200: '#fde68a',
							300: '#fcd34d',
							400: '#fbbf24',
							500: '#f59e0b',
							600: '#d97706',
							700: '#b45309',
							800: '#92400e',
							900: '#78350f'
						}
					}
				}
			}
		}
	</script>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
	<style>
		/* Shadcn-inspired custom styles */
		:root {
			--background: 0 0% 100%;
			--foreground: 240 10% 3.9%;
			--card: 0 0% 100%;
			--card-foreground: 240 10% 3.9%;
			--primary: 240 5.9% 10%;
			--primary-foreground: 0 0% 98%;
			--secondary: 240 4.8% 95.9%;
			--secondary-foreground: 240 5.9% 10%;
			--muted: 240 4.8% 95.9%;
			--muted-foreground: 240 3.8% 46.1%;
			--destructive: 0 84.2% 60.2%;
			--destructive-foreground: 0 0% 98%;
			--border: 240 5.9% 90%;
			--input: 240 5.9% 90%;
			--ring: 240 10% 3.9%;
			--radius: 0.5rem;
		}

		body {
			font-family: 'Poppins', sans-serif;
			background-color: hsl(var(--background));
			color: hsl(var(--foreground));
		}

		.card {
			background-color: hsl(var(--card));
			color: hsl(var(--card-foreground));
			border-radius: var(--radius);
			border: 1px solid hsl(var(--border));
			box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
		}

		.btn-primary {
			background-color: hsl(var(--primary));
			color: hsl(var(--primary-foreground));
			border: 1px solid hsl(var(--primary));
			border-radius: calc(var(--radius) - 2px);
			padding: 0.75rem 1.5rem;
			font-size: 0.875rem;
			font-weight: 500;
			transition: all 0.2s;
		}

		.btn-primary:hover {
			background-color: hsl(var(--primary) / 0.9);
			transform: translateY(-1px);
			box-shadow: 0 4px 12px 0 rgb(0 0 0 / 0.15);
		}

		.btn-secondary {
			background-color: transparent;
			color: hsl(var(--foreground));
			border: 1px solid hsl(var(--border));
			border-radius: calc(var(--radius) - 2px);
			padding: 0.75rem 1.5rem;
			font-size: 0.875rem;
			font-weight: 500;
			transition: all 0.2s;
		}

		.btn-secondary:hover {
			background-color: hsl(var(--muted));
		}

		.hero-gradient {
			background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
		}
	</style>
</head>
<body class="bg-gray-50">
	<!-- Header -->
	<header class="bg-white border-b border-gray-200 sticky top-0 z-10">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="flex justify-between items-center h-16">
				<div class="flex items-center">
					<h1 class="text-xl font-semibold text-gray-900 font-serif">40Weeks</h1>
					<span class="ml-2 text-sm text-primary-500 font-medium">BETA</span>
				</div>
				<div class="flex items-center space-x-4">
					<button onclick="logout()" class="text-sm text-gray-500 hover:text-gray-700">
						Sign out
					</button>
				</div>
			</div>
		</div>
	</header>

	<!-- Main Content -->
	<main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
		<!-- Welcome Section -->
		<div class="mb-8">
			<div class="hero-gradient rounded-lg p-6 text-white">
				<div class="flex items-center justify-between">
					<div>
						<h1 class="text-2xl font-bold font-serif mb-2">Welcome back!</h1>
						<p class="text-yellow-100" id="pregnancyGreeting">Loading your pregnancy details...</p>
					</div>
					<div class="text-right">
						<div class="text-3xl font-bold" id="currentWeek">--</div>
						<div class="text-yellow-100 text-sm">weeks</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Quick Actions -->
		<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
			<div class="card p-6 text-center hover:shadow-lg transition-shadow cursor-pointer" onclick="addToVillage()">
				<div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4">
					<svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
					</svg>
				</div>
				<h3 class="text-lg font-semibold text-gray-900 mb-2">Add to Your Village</h3>
				<p class="text-gray-600 text-sm">Invite family and friends to follow your journey</p>
			</div>

			<div class="card p-6 text-center hover:shadow-lg transition-shadow cursor-pointer" onclick="postUpdate()">
				<div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-4">
					<svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
					</svg>
				</div>
				<h3 class="text-lg font-semibold text-gray-900 mb-2">Post an Update</h3>
				<p class="text-gray-600 text-sm">Share photos and news with your village</p>
			</div>

			<div class="card p-6 text-center hover:shadow-lg transition-shadow cursor-pointer" onclick="viewMilestones()">
				<div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-4">
					<svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
					</svg>
				</div>
				<h3 class="text-lg font-semibold text-gray-900 mb-2">View Milestones</h3>
				<p class="text-gray-600 text-sm">Track upcoming appointments and events</p>
			</div>
		</div>

		<!-- Pregnancy Overview -->
		<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
			<!-- Pregnancy Details -->
			<div class="lg:col-span-2">
				<div class="card p-6">
					<h2 class="text-xl font-semibold text-gray-900 mb-4 font-serif">Your Pregnancy Details</h2>
					<div class="space-y-4" id="pregnancyDetails">
						<div class="flex justify-between items-center py-2 border-b border-gray-100">
							<span class="text-gray-600">Due Date</span>
							<span class="font-medium" id="dueDate">Loading...</span>
						</div>
						<div class="flex justify-between items-center py-2 border-b border-gray-100">
							<span class="text-gray-600">Baby's Name</span>
							<span class="font-medium" id="babyName">Loading...</span>
						</div>
						<div class="flex justify-between items-center py-2 border-b border-gray-100">
							<span class="text-gray-600">Partner</span>
							<span class="font-medium" id="partnerName">Loading...</span>
						</div>
						<div class="flex justify-between items-center py-2">
							<span class="text-gray-600">Weeks Remaining</span>
							<span class="font-medium" id="weeksRemaining">Loading...</span>
						</div>
					</div>
					<div class="mt-6">
						<button class="btn-secondary">Edit Details</button>
					</div>
				</div>
			</div>

			<!-- Upcoming Milestones -->
			<div>
				<div class="card p-6">
					<h2 class="text-xl font-semibold text-gray-900 mb-4 font-serif">Upcoming Milestones</h2>
					<div class="space-y-3" id="upcomingMilestones">
						<div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
							<div class="text-sm font-medium text-blue-800">Loading milestones...</div>
						</div>
					</div>
					<div class="mt-4">
						<button class="btn-secondary w-full" onclick="viewMilestones()">View All Milestones</button>
					</div>
				</div>
			</div>
		</div>
	</main>

	<script>
		const token = localStorage.getItem('jwt_token');
		
		if (!token) {
			window.location.href = '/login';
		}

		// Load pregnancy data on page load
		async function loadPregnancyData() {
			try {
				const response = await fetch('/api/pregnancy/current', {
					headers: {
						'Authorization': 'Bearer ' + token
					}
				});
				
				if (response.ok) {
					const data = await response.json();
					displayPregnancyData(data);
				} else if (response.status === 404) {
					// User doesn't have pregnancy setup, redirect to setup
					window.location.href = '/pregnancy-setup';
				} else {
					showError('Failed to load pregnancy data');
				}
			} catch (err) {
				showError('Network error loading pregnancy data');
			}
		}

		function displayPregnancyData(pregnancy) {
			// Update greeting
			const greeting = document.getElementById('pregnancyGreeting');
			const babyName = pregnancy.baby_name || 'Baby';
			greeting.textContent = `You're expecting ${babyName}!`;

			// Update current week
			const currentWeekEl = document.getElementById('currentWeek');
			currentWeekEl.textContent = pregnancy.current_week_calculated || '--';

			// Update pregnancy details
			const dueDate = new Date(pregnancy.due_date).toLocaleDateString();
			document.getElementById('dueDate').textContent = dueDate;
			document.getElementById('babyName').textContent = pregnancy.baby_name || 'Baby';
			document.getElementById('partnerName').textContent = pregnancy.partner_name || 'Not specified';
			
			// Calculate weeks remaining
			const today = new Date();
			const due = new Date(pregnancy.due_date);
			const diffTime = due - today;
			const weeksRemaining = Math.ceil(diffTime / (1000 * 60 * 60 * 24 * 7));
			document.getElementById('weeksRemaining').textContent = weeksRemaining > 0 ? `${weeksRemaining} weeks` : 'Due any day!';
		}

		function showError(message) {
			console.error(message);
			// Could add a toast notification here
		}

		// Action handlers
		function addToVillage() {
			// TODO: Implement village management
			alert('Village management coming soon!');
		}

		function postUpdate() {
			// TODO: Implement update posting
			alert('Update posting coming soon!');
		}

		function viewMilestones() {
			// TODO: Implement milestone view
			alert('Milestone tracking coming soon!');
		}

		function logout() {
			localStorage.removeItem('jwt_token');
			window.location.href = '/login';
		}

		// Load data when page loads
		loadPregnancyData();
	</script>
</body>
</html>